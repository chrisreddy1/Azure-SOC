# Building a SOC + Honeynet in Azure (Live Traffic)
![image](https://github.com/chrisreddy1/Azure-SOC/assets/156823759/0c07b605-2f46-4edb-9613-68406120264f)


## Introduction


In this project, I established a compact honeynet within Azure and integrated log data from various sources into a Log Analytics workspace. This data is then utilized by Microsoft Sentinel for generating attack visualizations, initiating alerts, and forming incidents. I conducted an evaluation of specific security metrics in a non-secured setting over a period of 24 hours. Following this, I implemented security enhancements to strengthen the environment and reassessed the metrics for an additional 24 hours. The results are presented below. The metrics under consideration include:

- SecurityEvent: This refers to Windows Event Logs.
- Syslog: This pertains to Linux Event Logs.
- SecurityAlert: These are alerts triggered within Log Analytics.
- SecurityIncident: Incidents that are generated by Sentinel.
- AzureNetworkAnalytics_CL: This tracks malicious network traffic allowed into our honeynet.

## Architecture Before Hardening / Security Controls
![image](https://github.com/chrisreddy1/Azure-SOC/assets/156823759/190f19fe-d028-424f-83d4-f63b7b326634)


## Architecture After Hardening / Security Controls
![image](https://github.com/chrisreddy1/Azure-SOC/assets/156823759/c4c6bdd9-28ce-4fde-8f0d-3e70dea4e94b)


The structure of the compact honeynet created within Azure comprises these elements:

- Virtual Network (VNet)
- Network Security Group (NSG)
- Virtual Machines (including 2 Windows and 1 Linux)
- Log Analytics Workspace
- Azure Key Vault
- Azure Storage Account
- Microsoft Sentinel

In the initial "BEFORE" phase, all the components were set up and made accessible over the internet. The Virtual Machines had their Network Security Groups and in-built firewalls completely open, and all other components were configured with publicly accessible endpoints; in other words, there was no implementation of Private Endpoints.

In the subsequent "AFTER" phase, the security was significantly enhanced. The Network Security Groups were configured to block all traffic except that from my administrative workstation. Additionally, all other resources were secured using their inherent firewalls along with the deployment of Private Endpoints.
## Attack Maps Before Hardening / Security Controls
<img width="678" alt="(before)-nsg-malicious-allowed-in" src="https://github.com/chrisreddy1/Azure-SOC/assets/156823759/ecac66e7-b367-4a8b-8713-23200b9e6756">
<br>
<img width="646" alt="(before)-linux-ssh-auth-fail" src="https://github.com/chrisreddy1/Azure-SOC/assets/156823759/566d5f10-692e-455a-a0ba-9529c697a6cf">
<br>
<img width="656" alt="(before)-windows-rdp-auth-fail" src="https://github.com/chrisreddy1/Azure-SOC/assets/156823759/4d817d63-518f-4f71-956a-14504c4b6dda">
<br>

## Metrics Before Hardening / Security Controls

The following table shows the metrics we measured in our insecure environment for 24 hours:
- Start Time 2024-01-15 18:40:03
- Stop Time 2024-01-16 18:40:03

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 36753
| Syslog                   | 10596
| SecurityAlert            | 7
| SecurityIncident         | 270
| AzureNetworkAnalytics_CL | 4694

## Attack Maps After Hardening / Security Controls

```All map queries actually returned no results due to no instances of malicious activity for the 24 hour period after hardening.```

## Metrics After Hardening / Security Controls

The following table shows the metrics we measured in our environment for another 24 hours, but after we have applied security controls:
- Start Time 2024-01-19 01:42:58
- Stop Time	2024-01-20 01:42:58

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 9120
| Syslog                   | 1
| SecurityAlert            | 0
| SecurityIncident         | 0
| AzureNetworkAnalytics_CL | 0

## Conclusion

In this project, a compact honeynet was developed using Microsoft Azure, where log sources were integrated into a Log Analytics workspace. Microsoft Sentinel was utilized for initiating alerts and creating incidents based on these logs. The project involved measuring metrics in an environment lacking security controls, and then remeasuring them after applying security enhancements. A significant observation was the substantial reduction in the number of security events and incidents post-implementation of these controls, which underscores their effectiveness.

It is important to consider that if the network's resources had been extensively used by regular users, there could have been a higher frequency of security events and alerts during the 24-hour period after the security controls were in place.
